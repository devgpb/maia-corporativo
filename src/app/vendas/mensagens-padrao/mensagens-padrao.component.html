<div class="max-w-6xl mx-auto p-4 space-y-6">
  <!-- Cabeçalho -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-semibold">Mensagens Padrão</h1>
      <div class="text-xs text-gray-600">Total: {{ total }} | Página: {{ pagina }} / {{ totalPaginas }} | Limite: {{ limite }}</div>
    </div>
    <button (click)="carregar()"
            class="inline-flex items-center px-4 py-2 rounded-md border text-sm font-medium hover:shadow">
      <span *ngIf="!carregando">Recarregar</span>
      <span *ngIf="carregando">Carregando...</span>
    </button>
  </div>

  <!-- Formulário de criação -->
  <form (ngSubmit)="criar()" [formGroup]="form" class="bg-white rounded-lg p-4 shadow space-y-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="md:col-span-1">
        <label class="block text-sm font-medium mb-1">Nome <span class="text-red-600">*</span></label>
        <input type="text" formControlName="nome" placeholder="Ex.: Boas-vindas"
               class="w-full rounded-md border p-2 focus:outline-none focus:ring"
               maxlength="255">
        <div class="text-xs text-red-600 mt-1" *ngIf="form.get('nome')?.invalid && form.get('nome')?.touched">
          Nome é obrigatório (máx. 255).
        </div>
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-medium mb-1">Mensagem <span class="text-red-600">*</span></label>
        <textarea rows="3" formControlName="mensagem" placeholder="Digite a mensagem padrão..."
                  class="w-full rounded-md border p-2 focus:outline-none focus:ring"></textarea>
        <div class="text-xs text-red-600 mt-1" *ngIf="form.get('mensagem')?.invalid && form.get('mensagem')?.touched">
          Mensagem é obrigatória.
        </div>
      </div>
    </div>

    <div class="flex items-center justify-end">
      <button type="submit" [disabled]="criando"
              class="inline-flex items-center px-5 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60">
        <span *ngIf="!criando">Adicionar</span>
        <span *ngIf="criando">Salvando...</span>
      </button>
    </div>
  </form>

  <!-- Paginação (topo) -->
  <nav class="flex items-center justify-center" *ngIf="totalPaginas > 1">
    <ul class="inline-flex items-stretch overflow-hidden rounded-md border text-sm">
      <li>
        <button (click)="irParaPrimeira()" [disabled]="pagina === 1"
                class="px-3 py-2 disabled:opacity-50 hover:bg-gray-50">« Primeiro</button>
      </li>
      <li>
        <button (click)="irParaAnterior()" [disabled]="pagina === 1"
                class="px-3 py-2 border-l disabled:opacity-50 hover:bg-gray-50">‹ Anterior</button>
      </li>
      <li *ngFor="let p of paginasVisiveis()">
        <button (click)="irPara(p)"
                class="px-3 py-2 border-l hover:bg-gray-50"
                [class.bg-blue-600]="p === pagina"
                [class.text-white]="p === pagina">
          {{ p }}
        </button>
      </li>
      <li>
        <button (click)="irParaProxima()" [disabled]="pagina === totalPaginas"
                class="px-3 py-2 border-l disabled:opacity-50 hover:bg-gray-50">Próxima ›</button>
      </li>
      <li>
        <button (click)="irParaUltima()" [disabled]="pagina === totalPaginas"
                class="px-3 py-2 border-l disabled:opacity-50 hover:bg-gray-50">Última »</button>
      </li>
    </ul>
  </nav>

  <!-- Lista de cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    <div *ngFor="let item of mensagens; trackBy: trackById"
         class="bg-white rounded-lg shadow p-4 flex flex-col h-full">
      <!-- Exibição -->
      <ng-container *ngIf="!isEditando(item.idMensagem); else editMode">
        <h3 class="text-lg font-semibold truncate" [title]="item.nome">{{ item.nome }}</h3>
        <p class="text-sm whitespace-pre-wrap break-words mt-2 flex-1">{{ item.mensagem }}</p>
        <div class="text-[11px] text-gray-500 mt-2">Atualizado em: {{ item.updatedAt | date:'short' }}</div>

        <!-- Ações (linha separada) -->
        <div class="mt-3 pt-3 border-t flex items-center justify-end gap-2">
          <button (click)="iniciarEdicao(item)"
                  class="px-3 py-1.5 rounded-md border text-sm hover:bg-gray-50">Editar</button>
          <button (click)="deletar(item)"
                  class="px-3 py-1 btn btn-danger ">Deletar</button>
        </div>
      </ng-container>

      <!-- Edição -->
      <ng-template #editMode>
        <div class="space-y-3 flex-1">
          <div>
            <label class="block text-xs font-medium mb-1">Nome</label>
            <input type="text"
                   [(ngModel)]="editBuffer[item.idMensagem].nome"
                   [ngModelOptions]="{standalone: true}"
                   class="w-full rounded-md border p-2 focus:outline-none focus:ring"
                   maxlength="255">
          </div>
          <div style="height: 75%;">
            <label class="block text-xs font-medium mb-1">Mensagem</label>
            <textarea rows="4"
                      [(ngModel)]="editBuffer[item.idMensagem].mensagem"
                      [ngModelOptions]="{standalone: true}"
                      class="w-full rounded-md border h-100 p-2 focus:outline-none focus:ring"></textarea>
          </div>
        </div>

        <div class="mt-3 pt-3 border-t flex items-center justify-end gap-2">
          <button (click)="cancelarEdicao(item.idMensagem)"
                  class="px-4 py-2 rounded-md border text-sm hover:bg-gray-50">Cancelar</button>
          <button (click)="salvarEdicao(item.idMensagem)"
                  [disabled]="salvandoId === item.idMensagem"
                  class="px-4 py-2 rounded-md bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-60">
            <span *ngIf="salvandoId !== item.idMensagem">Salvar</span>
            <span *ngIf="salvandoId === item.idMensagem">Salvando...</span>
          </button>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Vazio -->
  <div *ngIf="!carregando && mensagens.length === 0" class="text-center text-sm text-gray-500">
    Nenhuma mensagem cadastrada.
  </div>

  <!-- Paginação (rodapé) -->
  <nav class="flex items-center justify-center mt-4" *ngIf="totalPaginas > 1">
    <ul class="inline-flex items-stretch overflow-hidden rounded-md border text-sm">
      <li>
        <button (click)="irParaPrimeira()" [disabled]="pagina === 1"
                class="px-3 py-2 disabled:opacity-50 hover:bg-gray-50">« Primeiro</button>
      </li>
      <li>
        <button (click)="irParaAnterior()" [disabled]="pagina === 1"
                class="px-3 py-2 border-l disabled:opacity-50 hover:bg-gray-50">‹ Anterior</button>
      </li>
      <li *ngFor="let p of paginasVisiveis()">
        <button (click)="irPara(p)"
                class="px-3 py-2 border-l hover:bg-gray-50"
                [class.bg-blue-600]="p === pagina"
                [class.text-white]="p === pagina">
          {{ p }}
        </button>
      </li>
      <li>
        <button (click)="irParaProxima()" [disabled]="pagina === totalPaginas"
                class="px-3 py-2 border-l disabled:opacity-50 hover:bg-gray-50">Próxima ›</button>
      </li>
      <li>
        <button (click)="irParaUltima()" [disabled]="pagina === totalPaginas"
                class="px-3 py-2 border-l disabled:opacity-50 hover:bg-gray-50">Última »</button>
      </li>
    </ul>
  </nav>
</div>
