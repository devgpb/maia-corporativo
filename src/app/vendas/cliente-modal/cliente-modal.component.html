<app-modal class="cliente-edit-modal position-relative">
  <div class="p-3 position-relative">

    <!-- Botão Delete isolado, sempre no canto superior esquerdo -->
    <button
      class="btn btn-danger mb-2"
      type="button"
      (click)="delete()"
      [disabled]="isLoading"
      aria-label="Apagar Cliente"
    >
      <lucide-icon name="Trash2" class="" size="18"></lucide-icon>
    </button>

    <div *ngIf="formData">

      <!-- Datas em destaque -->
      <div class="bg-light rounded p-3 mb-4">
        <!-- Seção de criação e atualização centralizada -->
        <div class="d-flex flex-column align-items-center text-center">
          <div>
            <span class="fw-normal">Cadastrado por:</span>
            <span class="fw-bold fs-5 ms-1">{{ formData?.responsavel?.nomeCompleto }}</span>
            <span class="text-muted ms-2">{{ formData.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
          <div class="mt-1 text-muted">
            Atualizado: {{ formData.updatedAt | date:'dd/MM/yyyy HH:mm' }}
          </div>
        </div>

        <!-- Seção de métricas de tempo -->
        <div class="mt-3 d-flex align-items-center justify-content-between">
          <span>
            Criado há {{ calcularDias(formData.createdAt) }} {{ calcularDias(formData.createdAt) === 1 ? 'dia' : 'dias' }}
          </span>
          <span class="badge" [ngClass]="getBadgeClass(calcularDias(formData.createdAt))">
            {{ getBadgeText(calcularDias(formData.createdAt)) }}
          </span>
        </div>
    </div>


      <!-- Cabeçalho -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Editar Cliente #{{ formData.idCliente }}</h5>
        <button type="button" class="btn btn-sm btn-outline-secondary" (click)="close()">
          <lucide-icon name="X" size="18"></lucide-icon>
        </button>
      </div>

      <!-- Formulário -->
      <form>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Nome *</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="formData.nome"
              name="nome"
              (ngModelChange)="clearError('nome')"
              [class.is-invalid]="errors['nome']"
            />
            <div *ngIf="errors['nome']" class="invalid-feedback">
              {{ errors['nome'] }}
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Celular *</label>
            <input
              type="text"
              class="form-control"
              appMask="celular"
              placeholder="(99) 99999-9999"
              [(ngModel)]="formData.celular"
              name="celular"
              (ngModelChange)="clearError('celular')"
              [class.is-invalid]="errors['celular']"
            />
            <div *ngIf="errors['celular']" class="invalid-feedback">
              {{ errors['celular'] }}
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Cidade</label>
            <select class="form-select"  [(ngModel)]="formData.cidade" name="cidade">
              <option value="">Selecione</option>
              <option *ngFor="let cidade of cidades" [value]="cidade">{{ cidade }}</option>
            </select>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Status</label>
            <select class="form-select" [(ngModel)]="formData.status" name="status">
              <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
            </select>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Campanha</label>
            <select class="form-select form-control" [(ngModel)]="formData.campanha" name="campanha">
              <option value="">Selecione</option>
              <option *ngFor="let s of listaCampanhas" [value]="s">{{ s }}</option>
            </select>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Indicação</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="formData.indicacao"
              name="indicacao"
            />
          </div>

          <div class="col-12 mb-3">
            <label class="form-label">Observações</label>
            <textarea
              class="form-control"
              rows="3"
              [(ngModel)]="formData.observacao"
              name="observacao">
            </textarea>
          </div>
        </div>
      </form>

      <!-- Rodapé -->
      <div class="modal-footer d-flex flex-column flex-sm-row gap-2 justify-content-end mt-3">
        <button class="btn btn-primary w-100 w-sm-auto" (click)="save()" [disabled]="isLoading">
          <lucide-icon name="Save" class="me-2" size="18"></lucide-icon>
          Salvar
        </button>

        <button class="btn btn-outline-secondary w-100 w-sm-auto" (click)="close()" [disabled]="isLoading">
          <lucide-icon name="XCircle" class="me-2" size="18"></lucide-icon>
          Cancelar
        </button>
      </div>

    </div>
  </div>
</app-modal>
