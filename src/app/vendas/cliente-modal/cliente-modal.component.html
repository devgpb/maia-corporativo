<app-modal class="cliente-edit-modal position-relative">
  <div class="p-3 position-relative">

    <!-- Botão Delete isolado, sempre no canto superior esquerdo -->
    <button
      class="btn btn-danger mb-2"
      type="button"
      (click)="delete()"
      [disabled]="isLoading"
      aria-label="Apagar Cliente"
      >
      <ng-icon name="lucideTrash2" class="" size="18"></ng-icon>
    </button>

    @if (formData) {
      <div>
        <!-- Nome de quem cadastrou -->
        <div class="bg-light rounded p-3 mb-4 text-center">
          <span class="fw-normal">Cadastrado por:</span>
          <div class="fw-bold fs-5">{{ formData?.responsavel?.nomeCompleto }}</div>
        </div>
        <!-- Datas separadas -->
        <div class="bg-white rounded p-3 shadow-sm">
          <!-- Criado -->
          <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-2">
            <span class="fw-bold text-primary">Data de Criação</span>
            <span>{{ formData.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
          <!-- Atualizado -->
          <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-2">
            <span class="fw-bold text-success">Última Atualização</span>
            <span>{{ formData.updatedAt | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
          <!-- Último Contato (opcional) -->
          @if (formData.ultimoContato) {
            <div class="d-flex justify-content-between align-items-center">
              <span class="fw-bold text-warning">Último Contato</span>
              <span>{{ formData.ultimoContato | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
          }
        </div>
        <!-- Métricas de tempo -->
        <div class="mt-3 d-flex align-items-center justify-content-between">
          <span>
            Criado há {{ calcularDias(formData.createdAt) }} {{ calcularDias(formData.createdAt) === 1 ? 'dia' : 'dias' }}
          </span>
          <span class="badge" [ngClass]="getBadgeClass(calcularDias(formData.createdAt))">
            {{ getBadgeText(calcularDias(formData.createdAt)) }}
          </span>
        </div>
        <!-- Cabeçalho -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Editar Cliente #{{ formData.idCliente }}</h5>
          <button type="button" class="btn btn-sm btn-outline-secondary" (click)="close()">
            <ng-icon name="lucideX" size="18"></ng-icon>
          </button>
        </div>
        <!-- Formulário -->
        <form>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Nome *</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="formData.nome"
                name="nome"
                (ngModelChange)="clearError('nome')"
                [class.is-invalid]="errors['nome']"
                />
                @if (errors['nome']) {
                  <div class="invalid-feedback">
                    {{ errors['nome'] }}
                  </div>
                }
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Celular *</label>
                <input
                  type="text"
                  class="form-control"
                  appMask="celular"
                  placeholder="(99) 99999-9999"
                  [(ngModel)]="formData.celular"
                  name="celular"
                  (ngModelChange)="clearError('celular')"
                  [class.is-invalid]="errors['celular']"
                  />
                  @if (errors['celular']) {
                    <div class="invalid-feedback">
                      {{ errors['celular'] }}
                    </div>
                  }
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Cidade</label>
                  <ng-select
                    [items]="cidades"
                    [(ngModel)]="formData.cidade"
                    name="cidade"
                    [searchable]="true"
                    [clearable]="true"
                    [hideSelected]="true"
                    [addTag]="true"
                    placeholder="Digite ou selecione..."
                    (add)="onAddCidade($event)">
                  </ng-select>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Status</label>
                  <ng-select
                    [items]="statuses"
                    [(ngModel)]="formData.status"
                    name="status"
                    [searchable]="true"
                    [clearable]="true"
                    [hideSelected]="true"
                    [addTag]="true"
                    placeholder="Digite ou selecione..."
                    (add)="onAddStatus($event)">
                  </ng-select>
                </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Campanha</label>
                    <ng-select
                      [items]="listaCampanhas"
                      [(ngModel)]="formData.campanha"
                      name="campanha"
                      [searchable]="true"
                      [clearable]="true"
                      [hideSelected]="true"
                      [addTag]="true"
                      placeholder="Digite ou selecione..."
                      (add)="onAddCampanha($event)">
                    </ng-select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Indicação</label>
                    <input
                      type="text"
                      class="form-control"
                      [(ngModel)]="formData.indicacao"
                      name="indicacao"
                      />
                    </div>
                    <div class="col-12 mb-3">
                      <label class="form-label">Observações</label>
                      <textarea
                        class="form-control"
                        rows="3"
                        [(ngModel)]="formData.observacao"
                        name="observacao">
                      </textarea>
                    </div>
                  </div>
                </form>
                <!-- Rodapé -->
                <div class="modal-footer d-flex flex-column flex-sm-row gap-2 justify-content-end mt-3">
                  <button class="btn btn-primary w-100 w-sm-auto" (click)="save()" [disabled]="isLoading">
                    <ng-icon name="lucideSave" class="me-2" size="18"></ng-icon>
                    Salvar
                  </button>
                  <button class="btn btn-outline-secondary w-100 w-sm-auto" (click)="close()" [disabled]="isLoading">
                    <ng-icon name="lucideXCircle" class="me-2" size="18"></ng-icon>
                    Cancelar
                  </button>
                </div>
              </div>
            }
          </div>
        </app-modal>
