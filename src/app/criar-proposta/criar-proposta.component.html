<div class="container  w-100">

  <app-modal #modal class="info  " @fadeIn>

    <div class="modal-content">
      <div class="modal-header w-100">
        @if (loading) {
          <h3 class="modal-title w-100 text-center text-warning"  >Gerando Proposta...</h3>
        }

        @if (success) {
          <h3 class="modal-title w-100 text-center text-success" >Proposta Gerada</h3>
        }

        @if (!loading && !success) {
          <h3 class="modal-title w-100 text-center text-danger"  >Erro ao gerar proposta</h3>
        }

      </div>

      <div class="w-100 d-flex justify-content-center">

        @if (loading) {
          <div class="loading-container"  >
            <div class="loading-circle"></div>
          </div>
        }
      </div>

      <div class="w-100 d-flex justify-content-center">
        @if (success) {
          <i class="fa-regular fa-circle-check text-success big-icon"   ></i>
        }

        @if (!loading && !success) {
          <i class="fa-solid fa-triangle-exclamation big-icon text-danger"   ></i>
        }
      </div>

      @if (!loading && !success) {
        <p class="text-danger text-center"> Por favor, revise seus dados</p>
      }

      <div class="modal-footer">
        @if (success || !loading && !success) {
          <button type="button" class="btn btn-secondary" (click)="modal.close()"  >Fechar</button>
        }
      </div>
    </div>



  </app-modal>


  @if (!success) {
    <form (ngSubmit)="submitForm()" #contratoForm="ngForm" class="d-flex flex-column justify-content-center">
      <div class="card">
        <div class="card-header text-center ">
          <h3>Gerar Proposta</h3>
        </div>
      </div>
      <!-- Cliente -->
      <div class="card">
        <div class="card-header">
          <span>Cliente</span>
        </div>
        <div class="d-flex w-100 justify-content-center flex-wrap ">
          <div class="input line">
            <label for="nomeCliente" class="form-label">Nome do Cliente</label>
            <input type="text" class="form-control" id="nomeCliente" name="nomeCliente" [(ngModel)]="proposta.nomeCliente" style="width:350px" placeholder="Nome do cliente">
          </div>
          <div class="input line">
            <label for="cidadeCliente" class="form-label">Cidade do Cliente</label>
            <input type="text" class="form-control" id="cidadeCliente" name="cidadeCliente" [(ngModel)]="proposta.cidadeCliente" style="width:350px" placeholder="Cidade do cliente">
          </div>
          <!-- <div class="input line">
          <label for="endereco" class="form-label">Endereço do cliente</label>
          <input type="text" class="form-control" id="endereco" name="endereco" [(ngModel)]="proposta.endereco" style="width:350px" placeholder="Endereço do cliente">
        </div> -->
        <!-- detalhes [ngClass]="{'animate__fadeInUp': !comDetalhesPessoais, 'animate__fadeOutDown': comDetalhesPessoais}"-->
        <div class="personal-details w-100">
          <div class="details-list d-flex flex-wrap  justify-content-center animate__animated">
            <!-- <div class="input line">
            <label for="identidadeCliente" class="form-label">CPF/CNPJ</label>
            <input type="text" class="form-control" id="identidadeCliente" name="identidadeCliente" [(ngModel)]="infoPessoal.identidadeCliente" style="width:350px" placeholder="CPF ou CNPJ do cliente">
          </div> -->
          <!-- <div class="input line">
          <label for="rgCliente" class="form-label">RG</label>
          <input type="text" class="form-control" id="rgCliente" name="rgCliente" [(ngModel)]="infoPessoal.rgCliente" style="width:350px" (input)="applyRgMask($event)"
            placeholder="00.000.000-0">
          </div> -->
          <div class="input line">
            <label for="emailCliente" class="form-label">Email do cliente</label>
            <input type="text" class="form-control" id="emailCliente" name="emailCliente" [(ngModel)]="proposta.emailCliente" style="width:350px" placeholder="Email do cliente">
          </div>
          <div class="input line">
            <label for="telefoneCliente" class="form-label">Telefone do cliente</label>
            <input type="text" class="form-control" id="telefoneCliente" name="telefoneCliente" [(ngModel)]="proposta.telefoneCliente" style="width:350px" placeholder="(00)-0000-0000" (input)="applyCelularMask($event)">
          </div>
          <div class="input line">
            <label for="endereco" class="form-label">Endereço do cliente</label>
            <input type="text" class="form-control" id="endereco" name="endereco" [(ngModel)]="proposta.endereco" style="width:350px" placeholder="Endereço do cliente">
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Instalação -->
  <div class="card">
    <div class="card-header">
      <span>Conta de Energia</span>
    </div>
    <div class="d-flex w-100 justify-content-center overflow flex-wrap  ">
      <!-- <div class="input line">
      <label for="tipoConta" class="form-label">Tipo de Conta</label>
      <select class="form-select" id="tipoConta" name="tipoConta" [(ngModel)]="proposta.tipoConta" style="width:350px">
        <option value="Residencial">Residencial</option>
        <option value="Comercial">Comercial</option>
        <option value="Industrial">Industrial</option>
      </select>
    </div> -->
    <div class="input line">
          <label for="consumoCliente" class="form-label
          ">Kit</label>
      <input type="text" class="form-control" id="consumoCliente" name="consumoCliente" [(ngModel)]="proposta.consumoCliente" style="width:350px" placeholder="Consumo de Energia" currencyMask [options]="configMask">
    </div>
  </div>
</div>
<!-- Projetos -->
<div class="card">
  <div class="card-header">
    <span>Projeto</span>
  </div>
  <div class="d-flex w-100 justify-content-center flex-wrap  ">
    <!-- <div class="input line">
          <label for="custoProjeto" class="form-label
          ">Custo do Projeto</label>
    <input type="text" class="form-control" id="custoProjeto" name="custoProjeto" [(ngModel)]="proposta.custoProjeto" style="width:350px" placeholder="Custo do Projeto" currencyMask [options]="configMask">
  </div> -->
  <!-- Valor de entrada -->
  <!-- <div class="input line">
          <label for="valorEntrada" class="form-label
          ">Valor de Entrada</label>
  <input type="text" class="form-control" id="valorEntrada" name="valorEntrada" [(ngModel)]="proposta.valorEntrada" style="width:350px" placeholder="Valor de Entrada"  currencyMask [options]="configMask">
</div> -->
<div class="input line">
  <label for="telhadoCliente" class="form-label">Tipo de Estrutura</label>
  <select class="form-select" id="telhadoCliente" name="telhadoCliente" [(ngModel)]="proposta.telhadoCliente" style="width:350px">
    <option value="Solo">Solo</option>
    <option value="Telha Comum">Telha Comum</option>
    <option value="Brasilit">Brasilit</option>
    <option value="Laje">Laje</option>
  </select>
</div>
<!-- select tipo inversor -->
<!-- <div class="input line">
          <label for="tipoInversor" class="form-label
          ">Tipo de Inversor</label>
<select class="form-select" id="tipoInversor" name="tipoInversor" [(ngModel)]="proposta.tipoInversor" style="width:350px">
  <option value="String">String</option>
  <option value="Microinversor">Microinversor</option>
</select>
</div> -->
<!-- Desconto em porcentagem -->
<div class="input line">
  <label for="desconto" class="form-label">Desconto</label>
  <input type="text" class="form-control" id="desconto" name="desconto" [(ngModel)]="proposta.desconto" style="width:350px" placeholder="Desconto" (input)="applyPercentMask($event)">
</div>
</div>
</div>
</form>
}

@if (success) {
  <div class="bg-gradient-to-b from-blue-100 to-yellow-100 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-4xl">
      <div id="printSection" class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-yellow-400 to-orange-500 p-6 text-white">
          <div class="flex justify-between items-center">
            <img src="../../assets/Logo.png" alt="Logo Engemaia" class="h-16">
            <h1 class="text-3xl font-bold">Proposta Solar</h1>
          </div>
        </div>
        <!-- Content -->
        <div class="p-8">
          <!-- Kit Details -->
          <section class="mb-12">
            <h2 class="text-2xl font-semibold text-orange-600 mb-4 flex items-center">
              <ng-icon [name="sun" class="w-8 h-8 mr-2"></ng-icon> Seu Kit Solar
            </h2>
            <div class="bg-orange-50 rounded-xl p-6 grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="text-center">
                <p class="text-gray-600">Kit Sugerido</p>
                <strong class="text-xl text-orange-600">{{ propostaCliente?.kitSugerido }}</strong>
              </div>
              <div class="text-center">
                <p class="text-gray-600">Valor do Kit</p>
                <strong class="text-xl text-orange-600">{{ propostaCliente?.valorKit }}</strong>
              </div>
              <div class="text-center">
                <p class="text-gray-600">Garantia</p>
                <strong class="text-xl text-orange-600">7-12 anos Inversor<br>15-30 anos Placas</strong>
              </div>
            </div>
            @if (proposta.desconto != '0%' && proposta.desconto != '%') {
              <div class="mt-4 text-center">
                <span class="inline-block bg-yellow-400 text-yellow-800 text-lg font-semibold px-4 py-2 rounded-full">
                  <ng-icon [name="tag" class="w-5 h-5 inline mr-1"></ng-icon> Desconto de {{proposta.desconto}}
                </span>
              </div>
            }
          </section>
          <!-- Equipment Details -->
          <section class="mb-12">
            <h2 class="text-2xl font-semibold text-blue-600 mb-4 flex items-center">
              <ng-icon [name="cpu" class="w-8 h-8 mr-2"></ng-icon> Equipamentos
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="bg-blue-50 rounded-xl p-6">
                <h3 class="text-xl font-semibold text-blue-600 mb-3 flex items-center">
                  <ng-icon [name="zap" class="w-6 h-6 mr-2"></ng-icon> Inversor
                </h3>
                <ul class="space-y-2">
                  <li><strong>Quantidade:</strong> <span class="text-blue-600">1</span></li>
                  <li><strong>Potência:</strong> <span class="text-blue-600">{{ propostaCliente?.potInversor }} kW</span></li>
                  <li><strong>Marcas:</strong> SOLIS, HUAWEI, SUNGROW, GROWATT ou similar</li>
                </ul>
              </div>
              <div class="bg-yellow-50 rounded-xl p-6">
                <h3 class="text-xl font-semibold text-yellow-600 mb-3 flex items-center">
                  <ng-icon [name="sun" class="w-6 h-6 mr-2"></ng-icon> Placas Solares
                </h3>
                <ul class="space-y-2">
                  <li><strong>Quantidade:</strong> <span class="text-yellow-600">{{ propostaCliente?.quantPlacas }}</span></li>
                  <li><strong>Geração Estimada:</strong> <span class="text-yellow-600">{{ propostaCliente?.geracao }} kWh/m - {{propostaCliente?.geracao / 130}} kWp</span></li>
                  <li><strong>Potência da Placa:</strong> <span class="text-yellow-600">{{ propostaCliente?.potenciaPlaca }} Wp</span></li>
                  <li><strong>Marcas:</strong> OSDA, JINKO, JA, DAH, TRINA ou similar</li>
                </ul>
              </div>
            </div>
          </section>
          <!-- Payment Details -->
          <section class="mb-12">
            <h2 class="text-2xl font-semibold text-green-600 mb-4 flex items-center">
              <ng-icon [name="credit-card" class="w-8 h-8 mr-2"></ng-icon> Investimento
            </h2>
            <div class="bg-green-50 rounded-xl p-6">
              <p class="text-2xl mb-4"><strong>Valor Total:</strong> <span class="text-green-600 font-bold">{{ propostaCliente?.valorTotal }}</span></p>
              <p class="text-lg"><strong>Prazo de Entrega:</strong> <span class="text-green-600">{{ propostaCliente?.prasoEntrega }} dias</span></p>
            </div>
          </section>
          <!-- Client Details -->
          <section class="mb-12">
            <h2 class="text-2xl font-semibold text-purple-600 mb-4 flex items-center">
              <ng-icon [name="user" class="w-8 h-8 mr-2"></ng-icon> Seus Dados
            </h2>
            <div class="bg-purple-50 rounded-xl p-6 grid grid-cols-1 md:grid-cols-2 gap-4">
              <p><strong>Nome:</strong> {{ proposta.nomeCliente }}</p>
              <p><strong>Cidade:</strong> {{ proposta.cidadeCliente }}</p>
              <p><strong>Endereço:</strong> {{ proposta.endereco }}</p>
              <p><strong>Email:</strong> {{ proposta.emailCliente }}</p>
              <p><strong>Telefone:</strong> {{ proposta.telefoneCliente }}</p>
            </div>
          </section>
          <!-- Call to Action -->
          <section class="mb-12">
            <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl p-6 text-white text-center">
              <h2 class="text-2xl font-bold mb-4">🌟 Invista em Energia Solar com a Engemaia! 🌟</h2>
              <p class="text-lg">Economize na conta de energia e contribua para um futuro sustentável. Entre em contato hoje e garanta o melhor investimento para o seu lar!</p>
            </div>
          </section>
          <!-- Additional Messages -->
          @if (propostaCliente?.mensagemSolo || propostaCliente?.mensagemCidade) {
            <section>
              <h2 class="text-2xl font-semibold text-gray-600 mb-4 flex items-center">
                <ng-icon [name="info" class="w-8 h-8 mr-2"></ng-icon> Informações Adicionais
              </h2>
              <div class="bg-gray-100 rounded-xl p-6">
                @if (propostaCliente?.mensagemSolo) {
                  <p><strong>Solo:</strong> {{ propostaCliente?.mensagemSolo }}</p>
                }
                @if (propostaCliente?.mensagemCidade) {
                  <p><strong>Cidade:</strong> {{ propostaCliente?.mensagemCidade }}</p>
                }
              </div>
            </section>
          }
        </div>
        <!-- Footer -->
        <div class="bg-gray-100 p-6 flex justify-between items-center">
          <button (click)="success = false" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out flex items-center">
            <ng-icon [name="arrow-left" class="w-5 h-5 mr-2"></ng-icon> Voltar
          </button>
          <button (click)="downloadPdf()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out flex items-center">
            <ng-icon [name="download" class="w-5 h-5 mr-2"></ng-icon> Baixar PDF
          </button>
        </div>
      </div>
    </div>
  </div>
}


<div class="w-100 d-flex justify-content-end">
  <!-- <button type="submit" (click)="saveProposta()" class="btn btn-outline-secondary">Salvar Dados</button> -->
  <div class="space"></div>
  <button type="submit" (click)="submitForm()" class="btn btn-primary">Gerar Proposta</button>
</div>
</div>
