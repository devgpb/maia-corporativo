<div class="container  w-100">

  <app-modal #modal class="info  " @fadeIn>

    <div class="modal-content">
      <div class="modal-header w-100">
        <h3 class="modal-title w-100 text-center text-warning" *ngIf="loading"  >Gerando Proposta...</h3>

        <h3 class="modal-title w-100 text-center text-success" *ngIf="success" >Proposta Gerada</h3>

        <h3 class="modal-title w-100 text-center text-danger" *ngIf="!loading && !success"  >Erro ao gerar proposta</h3>

      </div>

      <div class="w-100 d-flex justify-content-center">

        <div class="loading-container" *ngIf="loading"  >
          <div class="loading-circle"></div>
        </div>
      </div>

      <div class="w-100 d-flex justify-content-center">
        <i class="fa-regular fa-circle-check text-success big-icon"  *ngIf="success"  ></i>

        <i class="fa-solid fa-triangle-exclamation big-icon text-danger"  *ngIf="!loading && !success"  ></i>
      </div>

      <p class="text-danger text-center" *ngIf="!loading && !success"> Por favor, revise seus dados</p>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="modal.close()" *ngIf="success || !loading && !success"  >Fechar</button>
      </div>
    </div>



  </app-modal>


  <form (ngSubmit)="submitForm()" #contratoForm="ngForm" class="d-flex flex-column justify-content-center" *ngIf="!success">
    <div class="card">
      <div class="card-header text-center ">
        <h3>Gerar Proposta</h3>
      </div>
    </div>

    <!-- Cliente -->
    <div class="card">
      <div class="card-header">
        <span>Cliente</span>
      </div>

      <div class="d-flex w-100 justify-content-center flex-wrap ">
        <div class="input line">
          <label for="nomeCliente" class="form-label">Nome do Cliente</label>
          <input type="text" class="form-control" id="nomeCliente" name="nomeCliente" [(ngModel)]="proposta.nomeCliente" style="width:350px" placeholder="Nome do cliente">
        </div>

        <div class="input line">
          <label for="cidadeCliente" class="form-label">Cidade do Cliente</label>
          <input type="text" class="form-control" id="cidadeCliente" name="cidadeCliente" [(ngModel)]="proposta.cidadeCliente" style="width:350px" placeholder="Cidade do cliente">
        </div>

        <!-- <div class="input line">
          <label for="endereco" class="form-label">Endereço do cliente</label>
          <input type="text" class="form-control" id="endereco" name="endereco" [(ngModel)]="proposta.endereco" style="width:350px" placeholder="Endereço do cliente">
        </div> -->

        <!-- detalhes [ngClass]="{'animate__fadeInUp': !comDetalhesPessoais, 'animate__fadeOutDown': comDetalhesPessoais}"-->
        <div class="personal-details w-100">


          <div class="details-list d-flex flex-wrap  justify-content-center animate__animated">
            <!-- <div class="input line">
              <label for="identidadeCliente" class="form-label">CPF/CNPJ</label>
              <input type="text" class="form-control" id="identidadeCliente" name="identidadeCliente" [(ngModel)]="infoPessoal.identidadeCliente" style="width:350px" placeholder="CPF ou CNPJ do cliente">
            </div> -->

            <!-- <div class="input line">
              <label for="rgCliente" class="form-label">RG</label>
              <input type="text" class="form-control" id="rgCliente" name="rgCliente" [(ngModel)]="infoPessoal.rgCliente" style="width:350px" (input)="applyRgMask($event)"
              placeholder="00.000.000-0">
            </div> -->

            <div class="input line">
              <label for="emailCliente" class="form-label">Email do cliente</label>
              <input type="text" class="form-control" id="emailCliente" name="emailCliente" [(ngModel)]="proposta.emailCliente" style="width:350px" placeholder="Email do cliente">
            </div>

            <div class="input line">
              <label for="telefoneCliente" class="form-label">Telefone do cliente</label>
              <input type="text" class="form-control" id="telefoneCliente" name="telefoneCliente" [(ngModel)]="proposta.telefoneCliente" style="width:350px" placeholder="(00)-0000-0000" (input)="applyCelularMask($event)">
            </div>

            <div class="input line">
              <label for="endereco" class="form-label">Endereço do cliente</label>
              <input type="text" class="form-control" id="endereco" name="endereco" [(ngModel)]="proposta.endereco" style="width:350px" placeholder="Endereço do cliente">

            </div>
          </div>
        </div>

      </div>
    </div>


    <!-- Instalação -->
    <div class="card">
      <div class="card-header">
        <span>Conta de Energia</span>
      </div>
      <div class="d-flex w-100 justify-content-center overflow flex-wrap  ">

        <!-- <div class="input line">
          <label for="tipoConta" class="form-label">Tipo de Conta</label>
          <select class="form-select" id="tipoConta" name="tipoConta" [(ngModel)]="proposta.tipoConta" style="width:350px">
            <option value="Residencial">Residencial</option>
            <option value="Comercial">Comercial</option>
            <option value="Industrial">Industrial</option>
          </select>
        </div> -->

        <div class="input line">
          <label for="consumoCliente" class="form-label
          ">Consumo de Energia</label>
          <input type="text" class="form-control" id="consumoCliente" name="consumoCliente" [(ngModel)]="proposta.consumoCliente" style="width:350px" placeholder="Consumo de Energia" currencyMask [options]="configMask">
        </div>



      </div>
    </div>

    <!-- Projetos -->
    <div class="card">
      <div class="card-header">
        <span>Projeto</span>
      </div>
      <div class="d-flex w-100 justify-content-center flex-wrap  ">
        <!-- <div class="input line">
          <label for="custoProjeto" class="form-label
          ">Custo do Projeto</label>
          <input type="text" class="form-control" id="custoProjeto" name="custoProjeto" [(ngModel)]="proposta.custoProjeto" style="width:350px" placeholder="Custo do Projeto" currencyMask [options]="configMask">
        </div> -->

        <!-- Valor de entrada -->
        <!-- <div class="input line">
          <label for="valorEntrada" class="form-label
          ">Valor de Entrada</label>
          <input type="text" class="form-control" id="valorEntrada" name="valorEntrada" [(ngModel)]="proposta.valorEntrada" style="width:350px" placeholder="Valor de Entrada"  currencyMask [options]="configMask">
        </div> -->

        <div class="input line">
          <label for="telhadoCliente" class="form-label">Tipo de Estrutura</label>
          <select class="form-select" id="telhadoCliente" name="telhadoCliente" [(ngModel)]="proposta.telhadoCliente" style="width:350px">
            <option value="Solo">Solo</option>
            <option value="Telha Comum">Telha Comum</option>
            <option value="Brasilit">Brasilit</option>
            <option value="Laje">Laje</option>

          </select>
        </div>

        <!-- select tipo inversor -->
        <!-- <div class="input line">
          <label for="tipoInversor" class="form-label
          ">Tipo de Inversor</label>
          <select class="form-select" id="tipoInversor" name="tipoInversor" [(ngModel)]="proposta.tipoInversor" style="width:350px">
            <option value="String">String</option>
            <option value="Microinversor">Microinversor</option>
          </select>
        </div> -->

        <!-- Desconto em porcentagem -->
        <div class="input line">
          <label for="desconto" class="form-label">Desconto</label>
          <input type="text" class="form-control" id="desconto" name="desconto" [(ngModel)]="proposta.desconto" style="width:350px" placeholder="Desconto" (input)="applyPercentMask($event)">
        </div>

      </div>
    </div>

  </form>

  <div class="proposta" *ngIf="success">
    <div class="w-100 d-flex justify-content-end mb-4">
      <div class="text-center " *ngIf="success">
        <button (click)="success = false" class="btn btn-danger">Voltar</button>
      </div>
    </div>
    <div class="container proposta-container" id="printSection">
      <div class="text-center mb-4">
        <img src="../../assets/Logo.png" alt="Logo Engemaia" class="logo-img">
      </div>

      <h2 class="mb-4 text-success">Proposta Comercial - Energia Solar</h2>

      <!-- DETALHES DO KIT -->


      <div class="kit-details mb-4">
        <h3 class="text-primary text-center"><i class="fas fa-solar-panel"></i> Detalhes do KIT</h3>
        <div class="kit-details-wrapper mb-4 d-flex flex-column justify-content-center text-center">
          <p>Kit Sugerido:</p><strong> {{ propostaCliente?.kitSugerido }}</strong>
          <p>Valor do Kit:</p><strong> {{ propostaCliente?.valorKit }}</strong>
          <p>Garantia:</p><strong> 7 a 12 anos Inversor, 15 a 30 anos Placas</strong>
          <div class="promotion-icon" *ngIf="proposta.desconto != '0%' && proposta.desconto != '%'">
            <img src="../../assets/Promocao.png" alt="">
            <span>-{{proposta.desconto}}!</span>
          </div>
        </div>

      </div>



      <!-- MATERIAIS E DETALHES -->
      <div class="material-details mb-4">
        <h4 class="text-primary text-center"><i class="fas fa-tools"></i> Materiais e Equipamentos</h4>

        <div class="materials-card-projs d-flex justify-content-center flex-wrap">

          <!-- Card do Inversor -->
          <div class="card-proj inversor-card-proj mb-3 mx-2">
            <h5 class="text-secondary"><i class="fas fa-bolt"></i> Inversor</h5>
            <p><strong>Quantidade de Inversores:</strong> <span class="highlight">1</span></p>
            <p><strong>Potência do Inversor:</strong> <span class="highlight">{{ propostaCliente?.potInversor }} kW</span></p>
            <p><strong>Marcas Trabalhadas:</strong> SOLIS, DEYE, SUNGROW, GROWATT ou similar</p>
          </div>

          <!-- Card das Placas -->
          <div class="card-proj placas-card-proj mb-3 mx-2">
            <h5 class="text-secondary"><i class="fas fa-solar-panel"></i> Placas</h5>
            <p><strong>Quantidade de Placas:</strong> <span class="highlight">{{ propostaCliente?.quantPlacas }}</span></p>
            <p><strong>Geração Estimada:</strong> <span class="highlight">{{ propostaCliente?.geracao }} kWh/m - {{propostaCliente?.geracao / 130}} kWp</span></p>
            <p><strong>Potência da Placa:</strong> <span class="highlight">{{ propostaCliente?.potenciaPlaca }} Wp</span></p>
            <p><strong>Marcas Trabalhadas:</strong> OSDA, JINKO, JA, DAH, TRINA ou similar</p>
          </div>

        </div>
      </div>

      <!-- VALORES E PAGAMENTO -->
      <div class="payment-details mb-4 mt-2">
        <h3 class="text-success"><i class="fas fa-money-bill-wave"></i> Valores e Pagamento</h3>

        <p><strong>Valor Total:</strong> <span class="highlight">{{ propostaCliente?.valorTotal }}</span></p>

        <div class="payment-options mt-3">
          <p><strong>Pagamento À Vista:</strong> <span class="highlight">{{ propostaCliente?.primeiroAVista }}</span> na assinatura do contrato e <span class="highlight">{{ propostaCliente?.segundoAVista }}</span> após conclusão da instalação</p>
          <p><strong>Pagamento Parcelado no Cartão (12x):</strong> <span class="highlight">{{ propostaCliente?.valorCartao }}</span></p>
          <p><strong>Pagamento Financiado (60x):</strong> <span class="highlight">{{ propostaCliente?.valorFinanciado }}</span></p>
          <p><strong>Prazo de Entrega:</strong> <span class="highlight">{{ propostaCliente?.prasoEntrega }} dias</span> (90 dias de carência)</p>
        </div>
      </div>



      <!-- Div detalhes do cliente -->
      <div class="client-details mt-5">
        <h3 class="text-primary text-center"><i class="fas fa-user"></i> Detalhes do Cliente</h3>
        <div class="client-details-wrapper d-flex flex-column justify-content-center flex-wrap">
          <p class="w-50"><strong>Nome:</strong> {{ proposta.nomeCliente }}</p>
          <p class="w-50"><strong>Cidade:</strong> {{ proposta.cidadeCliente }}</p>
          <p class="w-50"><strong>Endereço:</strong> {{ proposta.endereco }}</p>
          <p class="w-50"><strong>Email:</strong> {{ proposta.emailCliente }}</p>
          <p class="w-50"><strong>Telefone:</strong> {{ proposta.telefoneCliente }}</p>
        </div>
      </div>

      <div class="call-to-action mt-5">
        <h4 class="text-success text-center">🌟 Invista em energia limpa e sustentável com a Engemaia! 🌟</h4>
        <p class="text-center">Não perca a oportunidade de economizar na conta de energia e contribuir para um futuro mais verde. Contate-nos hoje e garanta o melhor investimento para o seu lar!</p>
      </div>

      <!-- Mensagens, se existirem -->
      <div *ngIf="propostaCliente?.mensagemSolo || propostaCliente?.mensagemCidade" class="mt-4">
        <h5 class="text-warning"><i class="fas fa-info-circle"></i> Detalhes:</h5>
        <p *ngIf="propostaCliente?.mensagemSolo"><strong>Solo:</strong> {{ propostaCliente?.mensagemSolo }}</p>
        <p *ngIf="propostaCliente?.mensagemCidade"><strong>Cidade:</strong> {{ propostaCliente?.mensagemCidade }}</p>
      </div>
    </div>
  </div>

  <div class="text-center" *ngIf="success">
    <button (click)="downloadPdf()" class="btn btn-success">Baixar PDF <i class="fas fa-file-download"></i></button>
  </div>

  <!-- Botão inverte sucess -->
  <div class="text-center mt-4" *ngIf="success">
    <button (click)="success = false" class="btn btn-danger">Voltar</button>
  </div>


  <div class="w-100 d-flex justify-content-end">
    <!-- <button type="submit" (click)="saveProposta()" class="btn btn-outline-secondary">Salvar Dados</button> -->
    <div class="space"></div>
    <button type="submit" (click)="submitForm()" class="btn btn-primary">Gerar Proposta</button>
  </div>
</div>
